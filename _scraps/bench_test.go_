package main

import (
	"quiz-admin/models/quiz"
	"quiz-admin/services/db"
	"testing"

	jsoniter "github.com/json-iterator/go"
)

var json = jsoniter.ConfigCompatibleWithStandardLibrary

// 30000	     39899 ns/op	    3148 B/op	      63 allocs/op
// 50000	     40660 ns/op	    3146 B/op	      63 allocs/op
// 50000	     39079 ns/op	    3146 B/op	      63 allocs/op
// 50000	     38880 ns/op	    3146 B/op	      63 allocs/op
// 50000	     36539 ns/op	    3146 B/op	      63 allocs/op
// 50000	     40180 ns/op	    3146 B/op	      63 allocs/op
// func BenchmarkJSON(b *testing.B) {
// 	db.Init()
// 	defer db.Conn.Close()
// 	var selectedFields = []string{"id", "name", "description", "questions"}
// 	bytes, _ := db.SelectQuizByID(1, selectedFields)

// 	for i := 0; i < b.N; i++ {
// 		var lq *quiz.Quiz
// 		json.Unmarshal(bytes, &lq)
// 	}
// }

// 200000	      9340 ns/op	    3249 B/op	      51 allocs/op
// 200000	      8834 ns/op	    3249 B/op	      51 allocs/op
// 200000	      9364 ns/op	    3249 B/op	      51 allocs/op
func BenchmarkJSONITER(b *testing.B) {
	db.Init()
	defer db.Conn.Close()
	var selectedFields = []string{"id", "name", "description", "questions"}
	bytes, _ := db.SelectQuizByID(1, selectedFields)

	for i := 0; i < b.N; i++ {
		var lq *quiz.Quiz
		json.Unmarshal(bytes, &lq)
	}
}
